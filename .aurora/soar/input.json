{
  "prompt": "Here are some examples:\n\nQuery: What does the calculate_total function in utils.py do?\n\nDecomposition: {\n  \"goal\": \"Understand the calculate_total function's purpose and behavior\",\n  \"subgoals\": [\n    {\n      \"description\": \"Locate and read calculate_total function in utils.py\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"ast_parser\"\n  ]\n}\n\nQuery: Add a new feature to validate email addresses in the user registration flow\n\nDecomposition: {\n  \"goal\": \"Implement email validation in user registration with proper error handling\",\n  \"subgoals\": [\n    {\n      \"description\": \"Analyze existing user registration flow and identify integration points\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Create email validation function with regex pattern and domain checks\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0\n      ]\n    },\n    {\n      \"description\": \"Write unit tests for email validation function\",\n      \"suggested_agent\": \"test-runner\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        1\n      ]\n    },\n    {\n      \"description\": \"Integrate validation into registration form with user-friendly error messages\",\n      \"suggested_agent\": \"refactoring-engine\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        1,\n        2\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        1\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        3\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"code_writer\",\n    \"test_runner\",\n    \"file_editor\"\n  ]\n}\n\nQuery: Refactor the payment processing system to support multiple payment providers with retry logic and proper error handling\n\nDecomposition: {\n  \"goal\": \"Design and implement a flexible payment provider abstraction layer with resilience features\",\n  \"subgoals\": [\n    {\n      \"description\": \"Analyze current payment processing implementation and identify tight coupling issues\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Audit payment-related security concerns and compliance requirements\",\n      \"suggested_agent\": \"security-scanner\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Design payment provider interface with abstract base class and provider implementations\",\n      \"suggested_agent\": \"llm-executor\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0,\n        1\n      ]\n    },\n    {\n      \"description\": \"Implement retry logic with exponential backoff and circuit breaker pattern\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        2\n      ]\n    },\n    {\n      \"description\": \"Create comprehensive error handling with specific exception types and recovery strategies\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        2\n      ]\n    },\n    {\n      \"description\": \"Update existing code to use new provider abstraction layer\",\n      \"suggested_agent\": \"refactoring-engine\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        3,\n        4\n      ]\n    },\n    {\n      \"description\": \"Write integration tests for each payment provider with mocked responses\",\n      \"suggested_agent\": \"test-runner\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5\n      ]\n    },\n    {\n      \"description\": \"Update API documentation with new payment flow and error codes\",\n      \"suggested_agent\": \"documentation-generator\",\n      \"is_critical\": false,\n      \"depends_on\": [\n        5\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0,\n        1\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        3,\n        4\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        5\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 5,\n      \"parallelizable\": [\n        6,\n        7\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"code_reader\",\n    \"code_writer\",\n    \"ast_parser\",\n    \"test_runner\",\n    \"security_audit\",\n    \"doc_generator\"\n  ]\n}\n\nQuery: Migrate the entire application from monolithic architecture to microservices with minimal downtime\n\nDecomposition: {\n  \"goal\": \"Execute phased microservices migration with zero-downtime deployment and rollback capability\",\n  \"subgoals\": [\n    {\n      \"description\": \"Perform comprehensive dependency analysis of current monolith to identify service boundaries\",\n      \"suggested_agent\": \"dependency-tracker\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Audit data flow and database dependencies to plan data migration strategy\",\n      \"suggested_agent\": \"code-analyzer\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Security assessment of API boundaries and authentication/authorization requirements\",\n      \"suggested_agent\": \"security-scanner\",\n      \"is_critical\": true,\n      \"depends_on\": []\n    },\n    {\n      \"description\": \"Design microservices architecture with service contracts and communication patterns\",\n      \"suggested_agent\": \"llm-executor\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        0,\n        1,\n        2\n      ]\n    },\n    {\n      \"description\": \"Create deployment pipeline and infrastructure-as-code for each microservice\",\n      \"suggested_agent\": \"llm-executor\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        3\n      ]\n    },\n    {\n      \"description\": \"Implement strangler fig pattern to gradually replace monolith components\",\n      \"suggested_agent\": \"refactoring-engine\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        4\n      ]\n    },\n    {\n      \"description\": \"Build comprehensive monitoring and observability with distributed tracing\",\n      \"suggested_agent\": \"llm-executor\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5\n      ]\n    },\n    {\n      \"description\": \"Create rollback procedures and disaster recovery plan\",\n      \"suggested_agent\": \"documentation-generator\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        5,\n        6\n      ]\n    },\n    {\n      \"description\": \"Execute phased migration with canary deployments and traffic shifting\",\n      \"suggested_agent\": \"llm-executor\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        6,\n        7\n      ]\n    },\n    {\n      \"description\": \"Validate system performance and conduct load testing for each phase\",\n      \"suggested_agent\": \"test-runner\",\n      \"is_critical\": true,\n      \"depends_on\": [\n        8\n      ]\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [\n        0,\n        1,\n        2\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 2,\n      \"parallelizable\": [\n        3\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 3,\n      \"parallelizable\": [\n        4\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 4,\n      \"parallelizable\": [\n        5\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 5,\n      \"parallelizable\": [\n        6,\n        7\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 6,\n      \"parallelizable\": [\n        8\n      ],\n      \"sequential\": []\n    },\n    {\n      \"phase\": 7,\n      \"parallelizable\": [\n        9\n      ],\n      \"sequential\": []\n    }\n  ],\n  \"expected_tools\": [\n    \"dependency_analyzer\",\n    \"code_reader\",\n    \"security_audit\",\n    \"infrastructure_provisioner\",\n    \"deployment_manager\",\n    \"test_runner\",\n    \"monitoring_setup\"\n  ]\n}\n\n---\n\nQuery: how do i enhance agent recovery for aur soar to detect it early without waiting\n\nRelevant Context Summary:\n## Relevant Code (15 elements found)\n\n\n### kb: Introduction\nFile: 01/improve-output-2026-01-14.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768427588723\n**Timestamp**: 2026-01-14T23:08:58.581300\n**User Query**: how do i improve the output of aur soar to include breakdown of subgoals decomposed?\n\n---\n```\n\n### kb: Introduction\nFile: 01/add-new-2026-01-14.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768428157415\n**Timestamp**: 2026-01-14T23:11:58.910675\n**User Query**: How do I add a new agent to the system?\n\n---\n```\n\n### kb: Introduction\nFile: 01/enhance-aur-2026-01-14.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768423422977\n**Timestamp**: 2026-01-14T21:54:42.720670\n**User Query**: how can i enhance aur mem search performance in retrieving results?\n\n---\n```\n\n### kb: Introduction\nFile: 01/enhance-aur-2026-01-14-4.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768425064670\n**Timestamp**: 2026-01-14T22:21:10.049023\n**User Query**: how can i enhance aur mem search performance in retrieving results?\n\n---\n```\n\n### kb: Introduction\nFile: 01/enhance-aur-2026-01-14-5.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768426446210\n**Timestamp**: 2026-01-14T22:39:40.580769\n**User Query**: how can i enhance aur mem search performance in retrieving results?\n\n---\n```\n\n### kb: Introduction\nFile: 01/enhance-aur-2026-01-14-2.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768424883450\n**Timestamp**: 2026-01-14T22:08:29.454569\n**User Query**: how can i enhance aur mem search performance in retrieving results?\n\n---\n```\n\n### kb: Introduction\nFile: 01/enhance-aur-2026-01-14-3.md\n```python\n# SOAR Conversation Log\n\n**Query ID**: soar-1768424449249\n**Timestamp**: 2026-01-14T22:11:33.920483\n**User Query**: how can i enhance aur mem search performance in retrieving results?\n\n---\n```\n\n### code: Metadata - Metadata\nFile: 01/enhance-aur-2026-01-14.md\nDescription: ## Metadata\n\n```json\n{\n  \"query_id\": \"soar-1768423422977\",\n  \"query\": \"how can i enhance aur mem search performance in retrieving results?\",\n  \"total_duration_ms\": 659741.1110401154,\n  \"total_cost_usd...\n\n### code: Metadata - Metadata\nFile: 01/improve-output-2026-01-14.md\nDescription: ## Metadata\n\n```json\n{\n  \"query_id\": \"soar-1768427588723\",\n  \"query\": \"how do i improve the output of aur soar to include breakdown of subgoals decomposed?\",\n  \"total_duration_ms\": 949856.2445640564,\n...\n\n### code: Metadata - Metadata\nFile: 01/enhance-aur-2026-01-14-5.md\nDescription: ## Metadata\n\n```json\n{\n  \"query_id\": \"soar-1768426446210\",\n  \"query\": \"how can i enhance aur mem search performance in retrieving results?\",\n  \"total_duration_ms\": 334368.91627311707,\n  \"total_cost_us...\n\n### code: Metadata - Metadata\nFile: 01/enhance-aur-2026-01-14-4.md\nDescription: ## Metadata\n\n```json\n{\n  \"query_id\": \"soar-1768425064670\",\n  \"query\": \"how can i enhance aur mem search performance in retrieving results?\",\n  \"total_duration_ms\": 605377.3214817047,\n  \"total_cost_usd...\n\n### code: Metadata - Metadata\nFile: 01/add-new-2026-01-14.md\nDescription: ## Metadata\n\n```json\n{\n  \"query_id\": \"soar-1768428157415\",\n  \"query\": \"How do I add a new agent to the system?\",\n  \"total_duration_ms\": 561494.5230484009,\n  \"total_cost_usd\": 0.0,\n  \"tokens_used\": {\n ...\n\n\n... and 3 more elements\n\nAvailable Agents: 1-create-prd, 2-generate-tasks, 3-process-task-list, business-analyst, context-initializer, docs-init, full-stack-dev, holistic-architect, master, orchestrator, product-manager, product-owner, qa-test-architect, scrum-master, test-soar, ux-expert\n\nDecompose this query into actionable subgoals in JSON format.",
  "system": "You are a query decomposition expert for a code reasoning system.\n\nYour task is to break down complex queries into concrete, actionable subgoals that can be\nexecuted by specialized agents.\n\nFor each subgoal, specify:\n1. A clear, specific goal statement\n2. The IDEAL agent (unconstrained - what SHOULD handle this task)\n3. A brief description of the ideal agent's capabilities\n4. The ASSIGNED agent (from available list - best match we have)\n5. Whether the subgoal is critical to the overall query\n6. Dependencies on other subgoals (by index)\n\nAvailable agents: 1-create-prd, 2-generate-tasks, 3-process-task-list, business-analyst, context-initializer, docs-init, full-stack-dev, holistic-architect, master, orchestrator, product-manager, product-owner, qa-test-architect, scrum-master, test-soar, ux-expert\n\nFor each subgoal, you must specify TWO agents:\n1. ideal_agent: The IDEAL agent for this task (any name, even if not available)\n2. assigned_agent: The BEST AVAILABLE agent from the list above\n\nCommon ideal agents (create if needed):\n- creative-writer: story editing, narrative, creative writing\n- data-analyst: data analysis, visualization, statistics\n- ux-designer: UI/UX design, wireframes, prototypes\n- devops-engineer: CI/CD, infrastructure, deployment\n- security-expert: security audits, vulnerability analysis\n\nCommon available agents:\n- business-analyst: research, market analysis, competitive intelligence\n- master: general tasks, multi-domain work\n- full-stack-dev: code implementation, debugging, refactoring\n- holistic-architect: architecture, system design, API design\n- product-manager/product-owner: product tasks, requirements\n\nYou MUST respond with valid JSON only. Use this exact schema:\n{\n  \"goal\": \"High-level goal summarizing what we're trying to achieve\",\n  \"subgoals\": [\n    {\n      \"description\": \"Specific subgoal description\",\n      \"ideal_agent\": \"agent-that-should-handle-this\",\n      \"ideal_agent_desc\": \"Brief description of ideal agent capabilities\",\n      \"assigned_agent\": \"best-available-agent\",\n      \"is_critical\": true/false,\n      \"depends_on\": [0, 1]  // indices of prerequisite subgoals\n    }\n  ],\n  \"execution_order\": [\n    {\n      \"phase\": 1,\n      \"parallelizable\": [0, 1],  // subgoal indices that can run in parallel\n      \"sequential\": [2]  // subgoals that must run after this phase\n    }\n  ],\n  \"expected_tools\": [\"list\", \"of\", \"expected\", \"tool\", \"types\"]\n}\n\nYou MUST respond with valid JSON only. Do not include markdown code blocks, explanations, or any text outside the JSON object.",
  "phase": "unknown",
  "tool": "claude"
}
